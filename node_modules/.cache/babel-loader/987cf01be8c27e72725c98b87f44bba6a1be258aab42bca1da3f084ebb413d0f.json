{"ast":null,"code":"import{useState,useCallback}from\"react\";import{fetchGptResponse}from\"../api/gptApi\";export function useDialogueLoop(_ref){let{speak,onBotMessage,setListening}=_ref;const[messages,setMessages]=useState([]);const handleUserSpeech=useCallback(async userText=>{setMessages(msgs=>[...msgs,{role:\"user\",content:userText}]);onBotMessage({role:\"user\",content:userText});setListening(false);const botText=await fetchGptResponse([...messages,{role:\"user\",content:userText}]);setMessages(msgs=>[...msgs,{role:\"assistant\",content:botText}]);onBotMessage({role:\"assistant\",content:botText});await speak(botText);setListening(true);},[messages,speak,onBotMessage,setListening]);return{handleUserSpeech};}","map":{"version":3,"names":["useState","useCallback","fetchGptResponse","useDialogueLoop","_ref","speak","onBotMessage","setListening","messages","setMessages","handleUserSpeech","userText","msgs","role","content","botText"],"sources":["C:/joebot/src/hooks/useDialogueLoop.js"],"sourcesContent":["import { useState, useCallback } from \"react\";\r\nimport { fetchGptResponse } from \"../api/gptApi\";\r\n\r\nexport function useDialogueLoop({ speak, onBotMessage, setListening }) {\r\n  const [messages, setMessages] = useState([]);\r\n\r\n  const handleUserSpeech = useCallback(async (userText) => {\r\n    setMessages(msgs => [...msgs, { role: \"user\", content: userText }]);\r\n    onBotMessage({ role: \"user\", content: userText });\r\n    setListening(false);\r\n    const botText = await fetchGptResponse([...messages, { role: \"user\", content: userText }]);\r\n    setMessages(msgs => [...msgs, { role: \"assistant\", content: botText }]);\r\n    onBotMessage({ role: \"assistant\", content: botText });\r\n    await speak(botText);\r\n    setListening(true);\r\n  }, [messages, speak, onBotMessage, setListening]);\r\n\r\n  return { handleUserSpeech };\r\n} "],"mappings":"AAAA,OAASA,QAAQ,CAAEC,WAAW,KAAQ,OAAO,CAC7C,OAASC,gBAAgB,KAAQ,eAAe,CAEhD,MAAO,SAAS,CAAAC,eAAeA,CAAAC,IAAA,CAAwC,IAAvC,CAAEC,KAAK,CAAEC,YAAY,CAAEC,YAAa,CAAC,CAAAH,IAAA,CACnE,KAAM,CAACI,QAAQ,CAAEC,WAAW,CAAC,CAAGT,QAAQ,CAAC,EAAE,CAAC,CAE5C,KAAM,CAAAU,gBAAgB,CAAGT,WAAW,CAAC,KAAO,CAAAU,QAAQ,EAAK,CACvDF,WAAW,CAACG,IAAI,EAAI,CAAC,GAAGA,IAAI,CAAE,CAAEC,IAAI,CAAE,MAAM,CAAEC,OAAO,CAAEH,QAAS,CAAC,CAAC,CAAC,CACnEL,YAAY,CAAC,CAAEO,IAAI,CAAE,MAAM,CAAEC,OAAO,CAAEH,QAAS,CAAC,CAAC,CACjDJ,YAAY,CAAC,KAAK,CAAC,CACnB,KAAM,CAAAQ,OAAO,CAAG,KAAM,CAAAb,gBAAgB,CAAC,CAAC,GAAGM,QAAQ,CAAE,CAAEK,IAAI,CAAE,MAAM,CAAEC,OAAO,CAAEH,QAAS,CAAC,CAAC,CAAC,CAC1FF,WAAW,CAACG,IAAI,EAAI,CAAC,GAAGA,IAAI,CAAE,CAAEC,IAAI,CAAE,WAAW,CAAEC,OAAO,CAAEC,OAAQ,CAAC,CAAC,CAAC,CACvET,YAAY,CAAC,CAAEO,IAAI,CAAE,WAAW,CAAEC,OAAO,CAAEC,OAAQ,CAAC,CAAC,CACrD,KAAM,CAAAV,KAAK,CAACU,OAAO,CAAC,CACpBR,YAAY,CAAC,IAAI,CAAC,CACpB,CAAC,CAAE,CAACC,QAAQ,CAAEH,KAAK,CAAEC,YAAY,CAAEC,YAAY,CAAC,CAAC,CAEjD,MAAO,CAAEG,gBAAiB,CAAC,CAC7B","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}